<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title> Mesaj Åifreleme Ä°stemcisi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light">
  <div class="container py-5 text-center">
    <h2 class="mb-4 text-primary"> Mesaj Åifreleme UygulamasÄ±</h2>
    
    <!-- ========================= -->
    <!-- ğŸ”’ ÅÄ°FRELEME FORMU -->
    <!-- ========================= -->
    <form id="encryptForm" class="card p-4 shadow-sm mb-4">

      <h5 class="text-start text-secondary mb-3"> Åifreleme</h5>

      <!-- Åifreleme YÃ¶ntemi -->
      <div class="mb-3">
        <label class="form-label">Åifreleme YÃ¶ntemi</label>
        <select class="form-select" name="method" id="methodSelect">

          <option value="caesar">Caesar Cipher</option>
          <option value="vigenere">VigenÃ¨re Cipher</option>
          <option value="affine">Affine Cipher</option>
          <option value="substitution">Substitution Cipher</option>
          <option value="railfence">Rail Fence Cipher</option>
          <option value="columnar">Columnar Transposition Cipher</option>
          <option value="hill">Hill Cipher</option>
          <option value="vernam">Vernam Cipher</option>

          <option value="aes_lib">AES (Library)</option>
          <option value="des_lib">DES (Library)</option>
          <option value="rsa_lib">RSA (Library)</option>
        </select>
      </div>

      <!-- ANAHTAR ALANLARI -->
      <div id="keyFields">

        <div class="mb-3" id="keySingle">
          <label class="form-label">Anahtar</label>
          <input type="text" name="key" class="form-control" value="3" />
        </div>

        <div class="mb-3" id="keyAESLib" style="display:none;">
          <label class="form-label">AES Key</label>
          <input type="text" name="keyAESLib" class="form-control">
        </div>

        <div class="mb-3" id="keyDESLib" style="display:none;">
          <label class="form-label">DES Key</label>
          <input type="text" name="keyDESLib" class="form-control">
        </div>

        <div id="rsaFields" style="display:none;">
          <label class="form-label">Public Key</label>
          <textarea name="public_key" class="form-control" rows="3"></textarea>

          <label class="form-label mt-2">Private Key</label>
          <textarea name="private_key" class="form-control" rows="3"></textarea>
        </div>

      </div>

      <div class="mb-3 mt-3">
        <label class="form-label">Mesaj</label>
        <textarea name="message" class="form-control" rows="3"></textarea>
      </div>

      <button class="btn btn-primary w-100">ğŸ”’ Åifrele</button>
    </form>

    <!-- ========================= -->
    <!-- ğŸ”“ DEÅÄ°FRELEME FORMU -->
    <!-- ========================= -->
    <form id="decryptForm" class="card p-4 shadow-sm">

  <h5 class="text-start text-secondary mb-3"> DeÅŸifreleme</h5>

  <div class="mb-3">
    <label class="form-label">Åifreli Metin</label>
    <textarea name="message" class="form-control" rows="3"></textarea>
  </div>

  <div class="mb-3">
    <label class="form-label">Anahtar</label>
    <input type="text" name="key" class="form-control">
  </div>

  <button type="button"
          class="btn btn-success w-100"
          onclick="decryptMessage()">
    ğŸ”“ DeÅŸifrele
  </button>

</form>

    <!-- SONUÃ‡ -->
    <div class="mt-4">
      <h5>ğŸ§© SonuÃ§:</h5>
      <p id="result" class="fw-bold text-success"></p>
    </div>

  </div>
<script>
// =====================================================
// TÃœM ALANLARI GÄ°ZLE
// =====================================================
function hideAll() {
  document.querySelectorAll("#keyFields > div").forEach(e => e.style.display = "none");
}

// =====================================================
// ÅÄ°FRE YÃ–NTEMÄ° SEÃ‡Ä°MÄ°
// =====================================================
document.getElementById("methodSelect").onchange = () => {
  hideAll();
  const m = document.getElementById("methodSelect").value;

  if (["caesar","vigenere","railfence"].includes(m)) keySingle.style.display = "block";
  else if (m === "affine") keyAffine.style.display = "flex";
  else if (m === "substitution") keySubstitution.style.display = "block";
  else if (m === "columnar") keyColumnar.style.display = "block";
  else if (m === "vernam") keyVernam.style.display = "block";

  // ğŸ”’ AES / DES / RSA (LIBRARY)
  else if (m === "aes_lib") keyAESLib.style.display = "block";
  else if (m === "des_lib") keyDESLib.style.display = "block";
  else if (m === "rsa_lib") rsaFields.style.display = "block";

  else if (m === "hill") hillInfo.style.display = "block";
};

// =====================================================
// RSA KEY GENERATE
// =====================================================
async function generateRSA() {
  const res = await fetch("/rsa/generate/");
  const data = await res.json();
  document.getElementById("rsa_public_key").value = data.public_key || "";
  document.getElementById("rsa_private_key").value = data.private_key || "";
}

// =====================================================
// ğŸ”’ ENCRYPT
// =====================================================
document.getElementById("encryptForm").onsubmit = async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const method = document.getElementById("methodSelect").value;
  let url = "";

  if (method === "aes_lib") {
    url = "/aes/encrypt/";
    formData.set("key", formData.get("keyAESLib"));
  }
  else if (method === "des_lib") {
    url = "/des/encrypt/";
    formData.set("key", formData.get("keyDESLib"));
  }
  else if (method === "rsa_lib") {
    url = "/rsa/encrypt/";
  }
  else if (method === "caesar") url = "/encrypt/";
  else if (method === "vigenere") url = "/vigenere/encrypt/";
  else if (method === "affine") url = "/affine/encrypt/";
  else if (method === "substitution") {
    url = "/substitution/encrypt/";
    formData.set("key", formData.get("keySub"));
  }
  else if (method === "railfence") url = "/railfence/encrypt/";
  else if (method === "columnar") {
    url = "/columnar/encrypt/";
    formData.set("key", formData.get("keyColumnar"));
  }
  else if (method === "vernam") {
    url = "/vernam/encrypt/";
    formData.set("key", formData.get("keyVernam"));
  }
  else if (method === "hill") url = "/hill/encrypt/";

  try {
    const res = await fetch(url, { method: "POST", body: formData });
    const data = await res.json();
    document.getElementById("result").innerText = data.result || "âŒ Sunucu hatasÄ±";
  } catch {
    document.getElementById("result").innerText = "âŒ BaÄŸlantÄ± hatasÄ±";
  }
};
</script>

<script>
// =====================================================
// ğŸ”“ DECRYPT  (BURASI ASIL DÃœZELTÄ°LEN YER)
// =====================================================
async function decryptMessage() {

  const form = document.getElementById("decryptForm");   // âœ… DOÄRU FORM
  const formData = new FormData(form);
  const method = document.getElementById("methodSelect").value;

  let url = "";

  // ğŸ”“ LIBRARY
  if (method === "aes_lib") {
    url = "/aes/decrypt/";
    formData.set("key", document.querySelector("[name='keyAESLib']").value);
    formData.set("message", formData.get("ciphertext"));
  }
  else if (method === "des_lib") {
    url = "/des/decrypt/";
    formData.set("key", document.querySelector("[name='keyDESLib']").value);
    formData.set("message", formData.get("ciphertext"));
  }
  else if (method === "rsa_lib") {
    url = "/rsa/decrypt/";
    formData.set("message", formData.get("ciphertext"));
  }

  // ğŸ”“ MANUEL
  else if (method === "caesar") {
    url = "/decrypt/";
    formData.set("message", formData.get("ciphertext"));
    formData.set("key", formData.get("decrypt_key"));
  }
  else if (method === "vigenere") {
    url = "/vigenere/decrypt/";
    formData.set("message", formData.get("ciphertext"));
    formData.set("key", formData.get("decrypt_key"));
  }
  else if (method === "affine") {
    url = "/affine/decrypt/";
    formData.set("message", formData.get("ciphertext"));
  }

  try {
    const res = await fetch(url, { method: "POST", body: formData });
    const data = await res.json();
    document.getElementById("result").innerText = data.result || "âŒ Sunucu hatasÄ±";
  } catch {
    document.getElementById("result").innerText = "âŒ BaÄŸlantÄ± hatasÄ±";
  }
}
</script>


</body>
</html>
